> 测试参考：OK1046测试、5728评估板测试



### A72 调频测试

核心板的 CPU 是动态调频的，启动后 CPU 调频策略为 ondemand，ondemand 模式按需快速动态调整 CPU 频率，一有 cpu 计算量的任务，会随计算量的大小动态调频，等执行完毕就立即回到最低频率。有时 CPU 的频率不能满足用户的需求，需要调整 CPU 的模式。下面以将 CPU 设置为performance 模式为例，操作如下：

列出当前的管理模式，查看 CPU 当前的频率：

```
root@ubuntu:~# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
ondemand //当前管理模式为系统默认的动态调频模式
root@ubuntu:~#  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
800000 //当前 CPU 频率为 0.8GHz
```

列出所有的管理模式

```
root@ubuntu:~# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors
conservative ondemand userspace powersave performance
```

列出 cpu 支持的频率

```
root@ubuntu:~# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies
1800000 1600000 900000 800000
```

改变 CPU 管理模式,设置为高性能模式

```
root@ubuntu:~# echo performance > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
```

列出 cpu 当前的管理模式，查看当前的 CPU 频率

```
root@ubuntu:~# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 
performance
root@ubuntu:~# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
1800000
```



### A72 CoreMark 测试

平台默认已经移植好了 CoreMark 测试程序

1、将 CPU 设置为高性能模式

```
root@ubuntu:~# echo performance > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
root@ubuntu:~# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
performance
```

2、CoreMark 测试

```
root@ubuntu:/home/gie# ./coremark.exe
2K performance run parameters for coremark.
CoreMark Size    : 666
Total ticks      : 10984
Total time (secs): 10.984000
Iterations/Sec   : 10014.566642
Iterations       : 110000
Compiler version : GCC7.5.0
Compiler flags   : -O2 -DPERFORMANCE_RUN=1  -lrt
Memory location  : Please put data memory location here
                        (e.g. code in flash, data on heap etc)
seedcrc          : 0xe9f5
[0]crclist       : 0xe714
[0]crcmatrix     : 0x1fd7
[0]crcstate      : 0x8e3a
[0]crcfinal      : 0x33ff
Correct operation validated. See README.md for run and reporting rules.
CoreMark 1.0 : 10014.566642 / GCC7.5.0 -O2 -DPERFORMANCE_RUN=1  -lrt / Heap
```

CoreMark测试结果：

| Core/Bus/DDR                                              | Coremark Thread # | Coremark/MHz | Coremark |
| --------------------------------------------------------- | ----------------- | ------------ | -------- |
| Gie-1046A<br/>(Core/Bus/DDR:1800MHz/7<br/>00MHz/2100MT/s) | 1                 | 5.56         | 10014.5  |

CoreMark/MHz 是指 CoreMark 得分除以 CPU 的频率（以兆赫兹为单位）。这个指标可以用来衡量系统的性能效率，即在每兆赫兹下执行 CoreMark 的性能。典型地，CoreMark/MHz 越高，表示系统在单位频率下执行 CoreMark 的性能越好。

CoreMark 得分是 10014.566642，而 CPU 的频率（MHz）为 1800 兆赫兹。要计算 CoreMark/MHz，需要将 CoreMark 得分除以 CPU 的频率。

假设 CPU 的频率是 X 兆赫兹，那么计算公式为：

CoreMark/MHz=CoreMark 得分/CPU 频率

根据提供的数据，假设 CPU 频率是 1800 兆赫兹，计算 CoreMark/MHz 为：

CoreMark/MHz=10014.566642/1800≈5.56

因此，得到的 CoreMark/MHz 是 5.56。这意味着在每兆赫兹下，系统能够执行 5.56 的 CoreMark。



### Memory 测试

Lmbench 是一套简易可移植的，符合 ANSI/C 标准为 UNIX/POSIX 而制定的微型测评工具。一般来

说，它衡量两个关键特征：反应时间和带宽。我们使用 LmBench 来测试 Gie-1046A平台 cache 以及

DDR 的带宽。

 Gie-1046A平台移植Lmbench

```
sudo apt-get install lmbench
```

如果无法找到`lat_mem_rd`、`bw_mem`等命令，则执行以下

```
sudo find / -name "lat_mem_rd"
export PATH=$PATH:/usr/lib/lmbench/bin
```

您可以使用以下命令进行测试：

```
root@ubuntu:~# bw_mem 100M rd //DDR读速度测试
100.00 9522.90                //读速度9522.90MB/s
root@ubuntu:~# bw_mem 100M wr //DDR写速度测试
100.00 3297.50                //写速度3297.50MB/s
root@ubuntu:~# bw_mem 100M cp //DDR拷贝速度测试
100.00 2054.48                //拷贝速度2054.48MB/s
```

Memtester 主要是捕获内存错误和一直处于很高或者很低的坏位， 其测试的主要项目有随机值，异或比较，减法，乘法，除法，与或运算等等。 通过给定测试内存的大小和次数，可以对系统现有的内存进行上面项目的测试。

使用 Memtester 测试工具申请 8MB 内存数量测试做 1 次 DDR 测试。执行如下指令：

```
memtester 8M 1
```



### USB2.0读写测试

先挂载U盘，然后创建测试的文件，`test`是文件名

```
time dd if=/dev/zero of=/mnt/test bs=1024K count=200 conv=fsync
```

`of`指定输出文件，`test`是文件名。这个命令的意思是将从`/dev/zero`中读取的数据写入到名为`test`的文件中。`/dev/zero`是一个特殊的设备文件，它返回一个无限的流0字节，因此在这个命令中，实际上是将一堆0写入到文件中。如果挂载点下没有这个文件，创建一个名为`test`的空文件。

#### 写速度测试

```
root@ubuntu:~# time dd if=/dev/zero of=/mnt/test bs=1024K count=200 conv=fsync
200+0 records in
200+0 records out
209715200 bytes (210 MB, 200 MiB) copied, 122.525 s, 1.7 MB/s

real    2m2.533s
user    0m0.000s
sys     0m0.699s
```

不同盘速度可能不一样

```
root@ubuntu:~# time dd if=/dev/zero of=/mnt/test bs=1024K count=200 conv=fsync
200+0 records in
200+0 records out
209715200 bytes (210 MB, 200 MiB) copied, 32.2147 s, 6.5 MB/s

real    0m32.216s
user    0m0.000s
sys     0m0.165s
```

#### 读速度测试

执行一遍后，使用的这些 cache 内容可以增加文件以及的读写速度。第二遍速度会很快，所以需要取第一次的数据，重启评估板或者执行下面指令清除缓存

```
echo 3 > /proc/sys/vm/drop_caches
```

进行测试

```
time dd if=/mnt/test of=/dev/null bs=1024K count=200
```

```
root@ubuntu:~# time dd if=/mnt/test of=/dev/null bs=1024K count=200
200+0 records in
200+0 records out
209715200 bytes (210 MB, 200 MiB) copied, 10.1772 s, 20.6 MB/s

real    0m10.184s
user    0m0.006s
sys     0m0.234s
root@ubuntu:~# time dd if=/mnt/test of=/dev/null bs=1024K count=200
200+0 records in
200+0 records out
209715200 bytes (210 MB, 200 MiB) copied, 0.0791264 s, 2.7 GB/s

real    0m0.082s
user    0m0.000s
sys     0m0.081s
```



### USB3.0读写测试

#### 写速度测试

```
root@ubuntu:~# time dd if=/dev/zero of=/mnt/test bs=1024K count=200 conv=fsync
200+0 records in
200+0 records out
209715200 bytes (210 MB, 200 MiB) copied, 7.22021 s, 29.0 MB/s

real    0m7.230s
user    0m0.000s
sys     0m0.191s
```

#### 读速度测试

执行一遍后，使用的这些 cache 内容可以增加文件以及的读写速度。第二遍速度会很快，所以需要取第一次的数据，重启评估板或者执行下面指令清除缓存

```
root@ubuntu:~# time dd if=/mnt/test of=/dev/null bs=1024K count=200
200+0 records in
200+0 records out
209715200 bytes (210 MB, 200 MiB) copied, 1.56141 s, 134 MB/s

real    0m1.571s
user    0m0.001s
sys     0m0.241s
```



### 温度测试

检测CPU温度

```
cat /sys/class/thermal/thermal_zone0/type
cat /sys/class/thermal/thermal_zone0/temp
```

```
gie@ubuntu:~$ cat /sys/class/thermal/thermal_zone0/temp
66000
```

执行以下命令进行一直检测温度

```
watch -n 1 cat /sys/class/thermal/thermal_zone0/temp
```

```
root@ubuntu:~# cat /sys/class/thermal/thermal_zone0/temp
50000
root@ubuntu:~# cat /sys/class/thermal/thermal_zone0/temp
50000
root@ubuntu:~# watch -n 1 cat /sys/class/thermal/thermal_zone0/temp
Every 1.0s: cat /sys/class/thermal/thermal_zone0/tempubuntu: Thu Mar  2 12:58:44 2023

50000
```



### mSATA 接口测试

平台支持一个 mSATA 接口 SATA 协议的固态硬盘，系统上电前将 mSATA 固态硬盘插入底板 mSATA 硬盘卡槽

上电后启动 linux，通过 lsblk可以看到对应设备枚举成功

```
root@ubuntu:~# lsblk
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda           8:0    0 119.2G  0 disk
`-sda1        8:1    0 119.2G  0 part
sdb           8:16   1  58.2G  0 disk
`-sdb1        8:17   1  58.2G  0 part /mnt
mmcblk0     179:0    0  29.8G  0 disk
|-mmcblk0p1 179:1    0   100M  0 part
|-mmcblk0p2 179:2    0     1G  0 part /boot
|-mmcblk0p3 179:3    0     6G  0 part
`-mmcblk0p4 179:4    0  22.6G  0 part /
```

先挂载固态硬盘

```
root@ubuntu:~# mount /dev/sda1 /mnt/
root@ubuntu:~# cd /mnt/
root@ubuntu:/mnt# ls
lost+found
root@ubuntu:/mnt# touch  test
root@ubuntu:/mnt# ls
lost+found  test
root@ubuntu:~# ls /mnt/test
/mnt/test
root@ubuntu:~# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root        23G  7.3G   14G  35% /
devtmpfs        1.9G     0  1.9G   0% /dev
tmpfs           1.9G     0  1.9G   0% /dev/shm
tmpfs           1.9G  852K  1.9G   1% /run
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           1.9G     0  1.9G   0% /sys/fs/cgroup
/dev/mmcblk0p2  976M   90M  819M  10% /boot
tmpfs           383M     0  383M   0% /run/user/0
/dev/sda1       117G   61M  111G   1% /mnt
```

#### 写速度测试

```
root@ubuntu:~# time dd if=/dev/zero of=/mnt/test bs=1024K count=4096 conv=fsync
4096+0 records in
4096+0 records out
4294967296 bytes (4.3 GB, 4.0 GiB) copied, 9.87247 s, 435 MB/s

real    0m9.921s
user    0m0.000s
sys     0m7.512s
```

#### 读速度测试

先重启评估板

```
root@ubuntu:~# time dd if=/mnt/test of=/dev/null bs=1024K count=4096
4096+0 records in
4096+0 records out
4294967296 bytes (4.3 GB, 4.0 GiB) copied, 6.66798 s, 644 MB/s

real    0m6.689s
user    0m0.008s
sys     0m3.225s
```

测试结果：

| 模式 | 文件系统 | 文件大小 | 耗时      | 速度     |
| ---- | -------- | -------- | --------- | -------- |
| 写   | exfat    | 4G       | 9.87247 s | 435 MB/s |
| 读   | exfat    | 4G       | 6.66798 s | 644 MB/s |



### RS-232测试

配置232信息，比如波特率等

```
stty -F /dev/ttyS2 115200 cs8 -cstopb -parenb
```

#### ls1046发送

ls1046窗口发送：

```
gie@ubuntu:~$ echo "Hello, World!" > /dev/ttyS2
gie@ubuntu:~$ echo "Hello, gie!" > /dev/ttyS2
```

windows下串口软件，比如xcom等，显示

```
Hello, World!
Hello, gie!
```

#### ls1046接收

ls1046窗口接收：

```
gie@ubuntu:~$ cat /dev/ttyS2
Hello, gie!
```

windows下串口软件，比如xcom等，发送

```
Hello, gie!
```

