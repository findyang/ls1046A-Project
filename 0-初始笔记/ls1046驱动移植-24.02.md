### 汇总需要适配及测试的外设

截止2024/2/21

- [x] 有线网口
  - [x] RGMII（2024.1.22完成调试）
  - [x] SGMII（2024.2.21完成调试）

- [ ] QPSI NOR FLASH（因为型号不匹配，不能识别到设备）

- [x] PCIe无线wifi模块（2024.1.9已成功联网但不稳定）

- [x] SATA固态硬盘（2023.10.20完成调试）

- [ ] 板载eMMC

- [ ] NAND FLASH（优先级低，因为ls1046无法从nand启动，作为存储又没有固态硬盘容量大）

- [x] 3路USB type-c（2023.12.15完成调试）
- [x] RS232（2023.12.7完成调试）
- [x] SD卡接口（2023.10.17完成调试）



### 有线网口

#### SGMII（2.21已解决）

当前能识别到设备，但是ping不通

[干货丨LS1046A&LS1028A平台的SerDes设计方案 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/270006798)

因为当前serdes1设计成3333，3333即是使用SGMII.9/10/5/6，使用的PLL为2222，即是第一路设置PPL2，第二路也是，所有使能SGMII时均是设置PLL2，根据参考手册上看，SRDS_PLL_REF_CLK_SEL_S1如果使用的是时钟频率是100MHz的话PPL2配置成0，是125MHz的话PPL2配置成1。PLL1不涉及，所以SRDS_PLL_REF_CLK_SEL_S1直接配置成0'b00即可。

> 其他例子说明（比如Serdes1模块选择RCW为1040：使用的时候2212，其中XFI.9（配置第一路）参考serdes1的PLL2，将S1的PLL2写为1：156MHz，QSGMII（配置第三路）参考serdes1的PLL1，将S1的PLL1写为0：100MHz）
>
> （举例：2222代表ABCD4条lane都使用PLL2，2211代表AB lane使用PLL2，CD lane使用PLL1，not available代表此方案不支持PCIe Gen3速度。）

因此以前（2023.12.12）的分析是正确的，不过那个时候还没解决mdio偏移地址错误的问题，重新再次测试，结果：

```
=> mii read 3 0x10
0000
=> mii write 3 0x1f 0xdf0
=> mii read 3 0x1f
0DF0
=> mii read 3 0x10
0907
```

按照瑞昱之前提供的读取寄存器值的方式，当前读取的值已经跟RDB的一致了

但还是ping不通，想起之前RGMII也是有时候通有时候不通，这个问题是因为网口线端接触不稳定，重新接上并晃动一下M12连接座子那部分的接口线，ping通了，SGMII在uboot上全部测试均通过

```
=> setenv ipaddr 192.168.0.232
=> setenv serverip 192.168.0.100
=> ping 192.168.0.100
Trying FM1@DTSEC9
eth_current->state: ETH_STATE_ACTIVE
Using FM1@DTSEC9 device
host 192.168.0.100 is alive
=> ping 192.168.0.100
Trying FM1@DTSEC5
eth_current->state: ETH_STATE_ACTIVE
Using FM1@DTSEC5 device
host 192.168.0.100 is alive
=> ping 192.168.0.100
Trying FM1@DTSEC6
eth_current->state: ETH_STATE_ACTIVE
Using FM1@DTSEC6 device
host 192.168.0.100 is alive
```

在进入系统后测试

mac9

```
root@ubuntu:~# ifconfig fm1-mac9 192.168.0.232
root@ubuntu:~# ethtool fm1-mac9
Settings for fm1-mac9:
Supported ports: [ MII ]
Supported link modes:   10baseT/Full 
                        100baseT/Full 
                        1000baseT/Full 
Supported pause frame use: Symmetric Receive-only
Supports auto-negotiation: Yes
Supported FEC modes: Not reported
Advertised link modes:  10baseT/Full 
                        100baseT/Full 
                        1000baseT/Full 
Advertised pause frame use: Symmetric Receive-only
Advertised auto-negotiation: Yes
Advertised FEC modes: Not reported
Link partner advertised link modes:  10baseT/Half 10baseT/Full 
                                     100baseT/Half 100baseT/Full 
                                     1000baseT/Full 
Link partner advertised pause frame use: Symmetric Receive-only
Link partner advertised auto-negotiation: Yes
Link partner advertised FEC modes: Not reported
Speed: 1000Mb/s
Duplex: Full
Port: MII
PHYAD: 3
Transceiver: internal
Auto-negotiation: on
Supports Wake-on: d
Wake-on: d
Current message level: 0xffffffff (-1)
       drv probe link timer ifdown ifup rx_err tx_err tx_queued intr tx_done rx_status pktdata hw wol 0xffff8000
Link detected: yes
root@ubuntu:~# ping 192.168.0.100
PING 192.168.0.100 (192.168.0.100) 56(84) bytes of data.
64 bytes from 192.168.0.100: icmp_seq=1 ttl=128 time=1.00 ms
64 bytes from 192.168.0.100: icmp_seq=2 ttl=128 time=0.559 ms
64 bytes from 192.168.0.100: icmp_seq=3 ttl=128 time=0.782 ms
^C
--- 192.168.0.100 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2017ms
rtt min/avg/max/mdev = 0.559/0.781/1.003/0.182 ms
```

mac5

```
root@ubuntu:~# ifconfig fm1-mac5 192.168.0.232
root@ubuntu:~# ping 192.168.0.100
PING 192.168.0.100 (192.168.0.100) 56(84) bytes of data.
64 bytes from 192.168.0.100: icmp_seq=1 ttl=128 time=0.487 ms
64 bytes from 192.168.0.100: icmp_seq=2 ttl=128 time=0.256 ms
64 bytes from 192.168.0.100: icmp_seq=3 ttl=128 time=0.551 ms
^C
--- 192.168.0.100 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2028ms
rtt min/avg/max/mdev = 0.256/0.431/0.551/0.127 ms
```

mac6

```
root@ubuntu:~# ifconfig fm1-mac6 192.168.0.232
root@ubuntu:~# ping 192.168.0.100
PING 192.168.0.100 (192.168.0.100) 56(84) bytes of data.
64 bytes from 192.168.0.100: icmp_seq=1 ttl=128 time=0.897 ms
64 bytes from 192.168.0.100: icmp_seq=2 ttl=128 time=0.315 ms
^C
--- 192.168.0.100 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1013ms
rtt min/avg/max/mdev = 0.315/0.606/0.897/0.291 ms
```

之后看下M12座子那端连接不稳定怎么解决





### QPSI NOR FLASH

因为采购型号不匹配，不能识别到设备，等待更换正确的型号进行测试







### 板载eMMC

eMMC电路设计是直接参考AFRWY的，参考的AFRWY是SD卡和eMMC电平引脚切换，自研使用拨码进行切换，分析是否会影响识别情况，



